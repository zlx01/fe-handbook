import{_ as s,c as a,o as n,d as l}from"./app.a4863d7a.js";const e="/fe-handbook/assets/5129415a283344689f4d599c3fe42b6a.a54639d0.png",o="/fe-handbook/assets/383f952b605f452b909f6382f8ca1930.d765d85e.png",p="/fe-handbook/assets/a89b621a4bb1458a855114436b33f3d0.7a154056.png",t="/fe-handbook/assets/6e13e49b9fec4201826153262b623712.2f6ea113.png",c="/fe-handbook/assets/fb6bd84ce2ec4725aa3ef38fe5f7b504.f54e8dc5.png",r="/fe-handbook/assets/1ac2961e2545441f8bbaac105f2f691f.705f0f73.png",b=JSON.parse('{"title":"Docker Build","description":"","frontmatter":{},"headers":[{"level":2,"title":"Dockerfile","slug":"dockerfile","link":"#dockerfile","children":[]},{"level":2,"title":"指令","slug":"指令","link":"#指令","children":[{"level":3,"title":"FROM","slug":"from","link":"#from","children":[]},{"level":3,"title":"Run","slug":"run","link":"#run","children":[]},{"level":3,"title":"COPY","slug":"copy","link":"#copy","children":[]},{"level":3,"title":"ADD","slug":"add","link":"#add","children":[]},{"level":3,"title":"CMD","slug":"cmd","link":"#cmd","children":[]},{"level":3,"title":"ENTRYPOINT","slug":"entrypoint","link":"#entrypoint","children":[]},{"level":3,"title":"CMD vs ENTRYPOINT","slug":"cmd-vs-entrypoint","link":"#cmd-vs-entrypoint","children":[]},{"level":3,"title":"ENV","slug":"env","link":"#env","children":[]},{"level":3,"title":"VOLUME","slug":"volume","link":"#volume","children":[]},{"level":3,"title":"WORKDIR","slug":"workdir","link":"#workdir","children":[]},{"level":3,"title":"ARG","slug":"arg","link":"#arg","children":[]},{"level":3,"title":"EXPOSE","slug":"expose","link":"#expose","children":[]},{"level":3,"title":"Other instructions","slug":"other-instructions","link":"#other-instructions","children":[]}]},{"level":2,"title":"Build context","slug":"build-context","link":"#build-context","children":[{"level":3,"title":"path context","slug":"path-context","link":"#path-context","children":[]},{"level":3,"title":"URL context","slug":"url-context","link":"#url-context","children":[]}]},{"level":2,"title":"multi-stage builds","slug":"multi-stage-builds","link":"#multi-stage-builds","children":[{"level":3,"title":"vue","slug":"vue","link":"#vue","children":[]},{"level":3,"title":"springboot","slug":"springboot","link":"#springboot","children":[]}]},{"level":2,"title":"Best Practice","slug":"best-practice","link":"#best-practice","children":[]}],"relativePath":"server/DevOps/docker/build.md","lastUpdated":1676394338000}'),i={name:"server/DevOps/docker/build.md"},C=l(`<h1 id="docker-build" tabindex="-1">Docker Build <a class="header-anchor" href="#docker-build" aria-hidden="true">#</a></h1><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># since 18.09, backward compatible with docker build. default builder</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">buildx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span></span>
<span class="line"></span></code></pre></div><h2 id="dockerfile" tabindex="-1"><a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noreferrer">Dockerfile</a> <a class="header-anchor" href="#dockerfile" aria-hidden="true">#</a></h2><blockquote><p>Docker builds images by reading the instructions from a Dockerfile. This is a text file containing instructions that adhere to a specific format needed to assemble your application into a container image.</p></blockquote><blockquote><p>Docker images consist of <strong>read-only layers</strong>, each resulting from an instruction in the Dockerfile. Layers are stacked sequentially and each one is a delta representing the changes applied to the previous layer.</p></blockquote><p>Dockerfile 是一个描述如何创建 Docker 镜像所需步骤的文本文件。由一系列指令组成。</p><ol><li>docker从基础镜像运行一个容器</li><li>执行一条指令并对容器作出修改</li><li>执行类似docker commit的操作提交一个新的镜像层</li><li>docker再基于刚提交的镜像运行一个新容器</li><li>执行dockerfile中的下一条指令直到所有指令都执行完成</li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 使用当前目录的Dockerfile创建镜像</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">myimage1:latest</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 使用指定目录的Dockerfile创建镜像</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">myimage2:latest</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-f</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">path/to/Dockerfile</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span></span>
<span class="line"></span></code></pre></div><p>the most common types of instructions:</p><table><thead><tr><th>Instruction</th><th>Description</th></tr></thead><tbody><tr><td><a href="https://docs.docker.com/engine/reference/builder/#from" target="_blank" rel="noreferrer">From &lt;image&gt;</a></td><td>Defines a base for your image.</td></tr><tr><td><a href="https://docs.docker.com/engine/reference/builder/#run" target="_blank" rel="noreferrer">RUN &lt;command&gt;</a></td><td>Executes any commands in a new layer on top of the current image and commits the result. <code>RUN</code> also has a shell form for running commands.</td></tr><tr><td><a href="https://docs.docker.com/engine/reference/builder/#workdir" target="_blank" rel="noreferrer">WORKDIR &lt;directory&gt;</a></td><td>Sets the working directory for any <code>RUN</code>, <code>CMD</code>, <code>ENTRYPOINT</code>, <code>COPY</code>, and <code>ADD</code> instructions that follow it in the Dockerfile.</td></tr><tr><td><a href="https://docs.docker.com/engine/reference/builder/#copy" target="_blank" rel="noreferrer">COPY &lt;src&gt; &lt;dest&gt;</a></td><td>Copies new files or directories from <code>and adds them to the filesystem of the container at the path</code>.</td></tr><tr><td><a href="https://docs.docker.com/engine/reference/builder/#cmd" target="_blank" rel="noreferrer">CMD &lt;command&gt;</a></td><td>Lets you define the default program that is run once you start the container based on this image. Each Dockerfile only has one <code>CMD</code>, and only the last <code>CMD</code> instance is respected when multiple exist.</td></tr></tbody></table><h2 id="指令" tabindex="-1">指令 <a class="header-anchor" href="#指令" aria-hidden="true">#</a></h2><h3 id="from" tabindex="-1"><code>FROM</code> <a class="header-anchor" href="#from" aria-hidden="true">#</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># tag默认latest</span></span>
<span class="line"><span style="color:#FFCB6B;">FROM</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">--platform</span><span style="color:#89DDFF;">=&lt;</span><span style="color:#A6ACCD;">platform</span><span style="color:#89DDFF;">&gt;]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">imag</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">AS </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">&gt;]</span></span>
<span class="line"><span style="color:#FFCB6B;">FROM</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">--platform</span><span style="color:#89DDFF;">=&lt;</span><span style="color:#A6ACCD;">platform</span><span style="color:#89DDFF;">&gt;]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">imag</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">[:</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">ta</span><span style="color:#A6ACCD;">g</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">AS </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">&gt;]</span></span>
<span class="line"><span style="color:#FFCB6B;">FROM</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">--platform</span><span style="color:#89DDFF;">=&lt;</span><span style="color:#A6ACCD;">platform</span><span style="color:#89DDFF;">&gt;]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">imag</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">[@</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">diges</span><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">AS </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">&gt;]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">FROM</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">openjdk:</span><span style="color:#F78C6C;">11</span><span style="color:#C3E88D;">-jre</span></span>
<span class="line"></span></code></pre></div><blockquote><p>The <code>FROM</code> instruction initializes a new build stage and sets the <a href="https://docs.docker.com/glossary/#base-image" target="_blank" rel="noreferrer"><em>Base Image</em></a> for subsequent instructions. As such, a valid <code>Dockerfile</code> must start with a <code>FROM</code> instruction.</p></blockquote><blockquote><ul><li>Optionally a name can be given to a new build stage by adding <code>AS name</code> to the <code>FROM</code> instruction. The name can be used in subsequent <code>FROM</code> and <code>COPY --from=</code> instructions to refer to the image built in this stage.</li></ul></blockquote><h3 id="run" tabindex="-1">Run <a class="header-anchor" href="#run" aria-hidden="true">#</a></h3><p>一条指令会在当前镜像的最顶层执行，并提交执行结果生成新的镜像层，供下一步使用。可以用<code>&amp;&amp;</code> 将多条指令合并成一个，指令太长可以用 <code>\\</code> 换行。</p><p>RUN has 2 forms:</p><ul><li><code>RUN </code> (<em>shell</em> form, the command is run in a shell, which by default is <code>/bin/sh -c</code> on Linux or <code>cmd /S /C</code> on Windows)</li><li><code>RUN [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]</code> (<em>exec</em> form)</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">RUN</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/bin/bash</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-c</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">echo hello</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># equivalent to</span></span>
<span class="line"><span style="color:#FFCB6B;">RUN</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/bin/bash</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">-c</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">echo hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">RUN</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apt-get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">update</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">apt-get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vim</span></span>
<span class="line"></span></code></pre></div><blockquote><p>Unlike the <em>shell</em> form, the <em>exec</em> form does not invoke a command shell. This means that normal shell processing does not happen.</p></blockquote><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># will not do variable substitution on $HOME</span></span>
<span class="line"><span style="color:#FFCB6B;">RUN</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">echo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#A6ACCD;">$HOME</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># correct</span></span>
<span class="line"><span style="color:#FFCB6B;">RUN</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">sh</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">-c</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">echo </span><span style="color:#A6ACCD;">$HOME</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre></div><h3 id="copy" tabindex="-1">COPY <a class="header-anchor" href="#copy" aria-hidden="true">#</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">COPY</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">--chown</span><span style="color:#89DDFF;">=&lt;</span><span style="color:#A6ACCD;">user</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">group</span><span style="color:#89DDFF;">&gt;]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">sr</span><span style="color:#A6ACCD;">c</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">...</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">des</span><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># This latter form is required for paths containing whitespace</span></span>
<span class="line"><span style="color:#FFCB6B;">COPY</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">--chown</span><span style="color:#89DDFF;">=&lt;</span><span style="color:#A6ACCD;">user</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">group</span><span style="color:#89DDFF;">&gt;]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">&lt;src&gt;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,...</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">&lt;dest&gt;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre></div><blockquote><p>The <code>&lt;src&gt;</code> path must be inside the <em>context</em> of the build。只能将复制本地文件至镜像内。</p></blockquote><blockquote><p><code>--from</code>参数用于在多阶段构建中，从前置构建或其他镜像复制文件。</p></blockquote><h3 id="add" tabindex="-1">ADD <a class="header-anchor" href="#add" aria-hidden="true">#</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">ADD</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">--chown</span><span style="color:#89DDFF;">=&lt;</span><span style="color:#A6ACCD;">user</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">group</span><span style="color:#89DDFF;">&gt;]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">--checksum</span><span style="color:#89DDFF;">=&lt;</span><span style="color:#A6ACCD;">checksum</span><span style="color:#89DDFF;">&gt;]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">sr</span><span style="color:#A6ACCD;">c</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">...</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">des</span><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># The latter form is required for paths containing whitespace.</span></span>
<span class="line"><span style="color:#FFCB6B;">ADD</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">--chown</span><span style="color:#89DDFF;">=&lt;</span><span style="color:#A6ACCD;">user</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">group</span><span style="color:#89DDFF;">&gt;]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">&lt;src&gt;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,...</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">&lt;dest&gt;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre></div><blockquote><p>If <code>&lt;src&gt;</code> is a <em>local</em> tar archive in a recognized compression format (identity, gzip, bzip2 or xz) then it is unpacked as a directory. Resources from <em>remote</em> URLs are <strong>not</strong> decompressed.</p></blockquote><h3 id="cmd" tabindex="-1">CMD <a class="header-anchor" href="#cmd" aria-hidden="true">#</a></h3><p>容器启动时运行的命令，只能有一条，多条的话最后一条生效</p><p>The <code>CMD</code> instruction has three forms:</p><ul><li><code>CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;]</code> (<em>exec</em> form, this is the preferred form)</li><li><code>CMD [&quot;param1&quot;,&quot;param2&quot;]</code> (as <em>default parameters to ENTRYPOINT</em>). If <code>CMD</code> is used to provide default arguments for the <code>ENTRYPOINT</code> instruction, both the <code>CMD</code> and <code>ENTRYPOINT</code> instructions should be specified with the JSON array format.</li><li><code>CMD command param1 param2</code> (<em>shell</em> form, execute in <code>/bin/sh -c</code>)</li></ul><h3 id="entrypoint" tabindex="-1">ENTRYPOINT <a class="header-anchor" href="#entrypoint" aria-hidden="true">#</a></h3><p>容器启动时运行的命令，只能有一条，多条的话最后一条生效。使用<code>docker run</code>命令创建容器时，<code>ENTRYPOINT</code>不能被覆盖，只能设置额外参数。</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">ENTRYPOINT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">executable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">param1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">param2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">ENTRYPOINT</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">command</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">param1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">param2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">ENTRYPOINT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">java</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">-jar</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">/application.jar</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre></div><p>举例1</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">FROM</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ubuntu</span></span>
<span class="line"><span style="color:#FFCB6B;">ENTRYPOINT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">top</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">-b</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#FFCB6B;">CMD</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">-c</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">test</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">top</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-H</span></span>
<span class="line"></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 最终执行</span></span>
<span class="line"><span style="color:#FFCB6B;">top</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-b</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-H</span></span>
<span class="line"></span></code></pre></div><p>举例2</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">FROM</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ubuntu</span></span>
<span class="line"><span style="color:#FFCB6B;">ENTRYPOINT</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">top</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-b</span></span>
<span class="line"></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">test</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">top</span></span>
<span class="line"></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 最终执行</span></span>
<span class="line"><span style="color:#FFCB6B;">top</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-b</span></span>
<span class="line"></span></code></pre></div><h3 id="cmd-vs-entrypoint" tabindex="-1">CMD vs ENTRYPOINT <a class="header-anchor" href="#cmd-vs-entrypoint" aria-hidden="true">#</a></h3><blockquote><ol><li>Dockerfile should specify at least one of <code>CMD</code> or <code>ENTRYPOINT</code> commands.</li><li><code>ENTRYPOINT</code> should be defined when using the container as an executable.</li><li><code>CMD</code> should be used as a way of defining default arguments for an <code>ENTRYPOINT</code> command or for executing an ad-hoc command in a container.</li><li><code>CMD</code> will be overridden when running the container with alternative arguments.</li></ol></blockquote><blockquote><ol><li>如果Docker镜像的用途是运行应用程序或服务，比如运行一个MySQL，应该优先使用Exec格式的ENTRYPOINT指令。CMD可为ENTRYPOINT提供额外的默认参数，同时可利用docker run命令行替换默认参数。</li><li>如果想为容器设置默认的启动命令，可使用CMD指令。用户可在docker run命令行中替换此默认命令。</li></ol></blockquote><table><thead><tr><th style="text-align:left;"></th><th style="text-align:left;">No ENTRYPOINT</th><th style="text-align:left;">ENTRYPOINT exec_entry p1_entry</th><th style="text-align:left;">ENTRYPOINT [“exec_entry”, “p1_entry”]</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>No CMD</strong></td><td style="text-align:left;"><em>error, not allowed</em></td><td style="text-align:left;">/bin/sh -c exec_entry p1_entry</td><td style="text-align:left;">exec_entry p1_entry</td></tr><tr><td style="text-align:left;"><strong>CMD [“exec_cmd”, “p1_cmd”]</strong></td><td style="text-align:left;">exec_cmd p1_cmd</td><td style="text-align:left;">/bin/sh -c exec_entry p1_entry</td><td style="text-align:left;">exec_entry p1_entry exec_cmd p1_cmd</td></tr><tr><td style="text-align:left;"><strong>CMD exec_cmd p1_cmd</strong></td><td style="text-align:left;">/bin/sh -c exec_cmd p1_cmd</td><td style="text-align:left;">/bin/sh -c exec_entry p1_entry</td><td style="text-align:left;">exec_entry p1_entry /bin/sh -c exec_cmd p1_cmd</td></tr></tbody></table><h3 id="env" tabindex="-1">ENV <a class="header-anchor" href="#env" aria-hidden="true">#</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">ENV</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">ke</span><span style="color:#A6ACCD;">y</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">=</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">valu</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">ENV</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">MY_NAME=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">John Doe</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#FFCB6B;">ENV</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">MY_DOG=Rex</span><span style="color:#A6ACCD;">\\ </span><span style="color:#C3E88D;">The</span><span style="color:#A6ACCD;">\\ </span><span style="color:#C3E88D;">Dog</span></span>
<span class="line"><span style="color:#FFCB6B;">ENV</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">MY_CAT=fluffy</span></span>
<span class="line"></span></code></pre></div><blockquote><p>You can view the values using <code>docker inspect</code>, and change them using <code>docker run --env &lt;key&gt;=&lt;value&gt;</code>.</p></blockquote><h3 id="volume" tabindex="-1">VOLUME <a class="header-anchor" href="#volume" aria-hidden="true">#</a></h3><blockquote><p>The <code>VOLUME</code> instruction creates a mount point with the specified name and marks it as holding externally mounted volumes from native host or other containers.</p></blockquote><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">VOLUME</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/data</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">FROM</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">alpine</span></span>
<span class="line"><span style="color:#FFCB6B;">RUN</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/myvol</span></span>
<span class="line"><span style="color:#FFCB6B;">RUN</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello world</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/myvol/greeting</span></span>
<span class="line"><span style="color:#FFCB6B;">VOLUME</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/myvol</span></span>
<span class="line"></span></code></pre></div><h3 id="workdir" tabindex="-1">WORKDIR <a class="header-anchor" href="#workdir" aria-hidden="true">#</a></h3><blockquote><p>The <code>WORKDIR</code> instruction sets the working directory for any <code>RUN</code>, <code>CMD</code>, <code>ENTRYPOINT</code>, <code>COPY</code> and <code>ADD</code> instructions that follow it in the <code>Dockerfile</code>.</p></blockquote><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">WORKDIR</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/path/to/workdir</span></span>
<span class="line"></span></code></pre></div><h3 id="arg" tabindex="-1">ARG <a class="header-anchor" href="#arg" aria-hidden="true">#</a></h3><blockquote><p>The <code>ARG</code> instruction defines a variable that users can pass at build-time to the builder with the <code>docker build</code> command using the <code>--build-arg &lt;varname&gt;=&lt;value&gt;</code> flag.</p></blockquote><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">ARG</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">nam</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">[=</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">valu</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">]</span></span>
<span class="line"></span></code></pre></div><p>example: <a href="https://docs.npmjs.com/docker-and-private-modules" target="_blank" rel="noreferrer">https://docs.npmjs.com/docker-and-private-modules</a></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">FROM</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">node</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">ARG</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">NPM_TOKEN</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#FFCB6B;">COPY</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.npmrc</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.npmrc</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#FFCB6B;">COPY</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">package.json</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">package.json</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#FFCB6B;">RUN</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#FFCB6B;">RUN</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-f</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.npmrc</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Add your source files</span></span>
<span class="line"><span style="color:#FFCB6B;">COPY</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#FFCB6B;">CMD</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span></span>
<span class="line"></span></code></pre></div><p>.npmrc</p><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">//registry.npmjs.org/:_authToken=\${NPM_TOKEN}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--build-arg</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">NPM_TOKEN=</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">NPM_TOKEN</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span></span>
<span class="line"></span></code></pre></div><h3 id="expose" tabindex="-1">EXPOSE <a class="header-anchor" href="#expose" aria-hidden="true">#</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># protocol默认tcp</span></span>
<span class="line"><span style="color:#FFCB6B;">EXPOSE</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">por</span><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[&lt;</span><span style="color:#A6ACCD;">port</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">/</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">protocol</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">...</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">EXPOSE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8080</span></span>
<span class="line"><span style="color:#FFCB6B;">EXPOSE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6379</span><span style="color:#C3E88D;">/tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">53</span><span style="color:#C3E88D;">/udp</span></span>
<span class="line"></span></code></pre></div><h3 id="other-instructions" tabindex="-1">Other instructions <a class="header-anchor" href="#other-instructions" aria-hidden="true">#</a></h3><ul><li><p>LABEL：adds metadata to an image.</p></li><li><p>USER：指定之后的 RUN、CMD 和 ENTRYPOINT 指令执行使用的用户</p></li></ul><h2 id="build-context" tabindex="-1"><a href="https://docs.docker.com/build/building/context/" target="_blank" rel="noreferrer">Build context</a> <a class="header-anchor" href="#build-context" aria-hidden="true">#</a></h2><h3 id="path-context" tabindex="-1">path context <a class="header-anchor" href="#path-context" aria-hidden="true">#</a></h3><p>对于 <code>.</code>，旧的构建工具会把整个当前目录暴露给daemon，而对于BuildKit，只会暴露指令（例如COPY）使用到的路径。可以用<code>dockerignore</code>排除某些目录（例如node_modules）</p><h3 id="url-context" tabindex="-1">URL context <a class="header-anchor" href="#url-context" aria-hidden="true">#</a></h3><p><a href="https://github.com/zlx01/docker-build-url-context" target="_blank" rel="noreferrer">git repository</a></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">hello-flask:latest</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/zlx01/docker-build-url-context.git</span></span>
<span class="line"></span></code></pre></div><p><img src="`+e+`" alt="在这里插入图片描述"></p><h2 id="multi-stage-builds" tabindex="-1"><a href="https://docs.docker.com/build/building/multi-stage/" target="_blank" rel="noreferrer">multi-stage builds</a> <a class="header-anchor" href="#multi-stage-builds" aria-hidden="true">#</a></h2><blockquote><p>With multi-stage builds, you use multiple <code>FROM</code> statements in your Dockerfile. Each <code>FROM</code> instruction can use a different base, and each of them begins a new stage of the build. You can selectively copy artifacts from one stage to another, leaving behind everything you don’t want in the final image.</p></blockquote><p>举例：</p><ul><li>在node镜像中打包vue项目，把产物复制到nginx镜像中</li><li>在maven镜像中springboot项目，把产物复制到jre镜像中</li></ul><h3 id="vue" tabindex="-1">vue <a class="header-anchor" href="#vue" aria-hidden="true">#</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">FROM</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">node</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">WORKDIR</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/app</span></span>
<span class="line"><span style="color:#FFCB6B;">COPY</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">RUN</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--registry=https://registry.npmmirror.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">RUN</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">FROM</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#FFCB6B;">COPY</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--from=build</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/app/dist</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/share/nginx/html</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">EXPOSE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">80</span></span>
<span class="line"></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vue3-test:v3</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span></span>
<span class="line"></span></code></pre></div><p><img src="`+o+'" alt="在这里插入图片描述"> 可以看到本地已经打包好镜像了，镜像大小和nginx接近，如果把node也包括进来，镜像竟然要达到接近1000MB， <img src="'+p+`" alt="在这里插入图片描述"></p><p>跑起来看看</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8090</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">80</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vue3-test:v3</span></span>
<span class="line"></span></code></pre></div><p><img src="`+t+`" alt="在这里插入图片描述"></p><h3 id="springboot" tabindex="-1">springboot <a class="header-anchor" href="#springboot" aria-hidden="true">#</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">FROM</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">maven:3.8.6-openjdk-</span><span style="color:#F78C6C;">11</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">COPY</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">RUN</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mvn</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-B</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">package</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--file</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pom.xml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">FROM</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">openjdk:</span><span style="color:#F78C6C;">11</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">COPY</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--from=0</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./target/springboot-demo-0.0.1-SNAPSHOT.jar</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/app/hello.jar</span></span>
<span class="line"><span style="color:#FFCB6B;">WORKDIR</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">EXPOSE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8080</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">ENTRYPOINT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">java</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">-jar</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">hello.jar</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre></div><p><img src="`+c+`" alt="在这里插入图片描述"></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8080</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">8080</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">springboot-test:v1</span></span>
<span class="line"></span></code></pre></div><p><img src="`+r+`" alt="在这里插入图片描述"></p><h2 id="best-practice" tabindex="-1">Best Practice <a class="header-anchor" href="#best-practice" aria-hidden="true">#</a></h2><div class="language-dockerfile"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">FROM ubuntu</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN apt-get update</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN apt-get install -y curl</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>再安装一个wget，<code>apt-get update</code>会有缓存，curl可能安装到过时的版本</p><div class="language-dockerfile"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">FROM ubuntu</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN apt-get update</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN apt-get install -y curl wget</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><div class="language-dockerfile"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">FROM ubuntu</span></span>
<span class="line"><span style="color:#A6ACCD;"># 最好是每次都update，同时也能减少镜像层数，减少包的体积</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN apt-get update &amp;&amp; apt-get install -y curl</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div>`,97),y=[C];function D(d,A,h,u,F,g){return n(),a("div",null,y)}const E=s(i,[["render",D]]);export{b as __pageData,E as default};
